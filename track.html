<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />

<head>
    <!-- Basic Page Needs -->
    <meta charset="utf-8">
    <title>Firstreed Express Delivery Services | Track Shipment</title>

    <!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Bootstrap  -->
    <link rel="stylesheet" type="text/css" href="stylesheets/bootstrap.css">

    <!-- Theme Style -->
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">

    <!-- Responsive -->
    <link rel="stylesheet" type="text/css" href="stylesheets/responsive.css">

    <!-- Colors -->
    <link rel="stylesheet" type="text/css" href="stylesheets/colors/color2.css" id="colors">

    <!-- Animation Style -->
    <link rel="stylesheet" type="text/css" href="stylesheets/animate.css">

    <!-- Favicon and touch icons  -->
    <link href="images/favicon.png" rel="shortcut icon">

    <link href="securelog/css/bootstrap.min.css" rel="stylesheet">
    <link href="securelog/css/style.css" rel="stylesheet" />

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script type="text/javascript" src="securelog/js/jquery.js"></script>
</head>

<body>

    <div class="boxed">
        <!-- Site Header -->
        <div class="site-header">
            <header id="header" class="header clearfix">
                <div class="header-wrap clearfix">
                    <div class="container">
                        <div class="row">
                            <div class="flat-wrapper">
                                <div style='width: auto; height: 60px; float: left; margin: 15px 0; padding-right: 20px;'>
                                    <a href="./">
                                        <img src="images/logo2a.png" alt="Firstreed Logo" style="width: 250px; height: 70px; float: left; margin: 20px 0;">
                                    </a>
                                </div><!-- /.logo -->
                                <div class="btn-menu">
                                    <span></span>
                                </div><!-- //mobile menu button -->

                                <div class="nav-wrap">
                                    <nav id="mainnav" class="mainnav">
                                        <div class="menu-extra">
                                            <ul>
                                                <li id="s" class="search-box">
                                                    <a href="#search" class="flat-search"><i
                                                            class="fa fa-search"></i></a>
                                                    <div class="submenu top-search">
                                                        <div class="widget widget_search">
                                                            <form class="search-form" action="track.html" method="get">
                                                                <input type="search" class="search-field"
                                                                    placeholder="Search â€¦" name="tcode">
                                                                <input type="submit" class="search-submit">
                                                            </form>
                                                        </div>
                                                    </div>
                                                </li>

                                            </ul>

                                        </div><!-- /.menu-extra -->
                                        <ul class="menu">

                                            <li class="active current home">
                                                <a href="./">Home</a>
                                            </li>
                                            <li class="">
                                                <a href="about.html">About</a>
                                            </li>
                                            <li class="">
                                                <a href="services.html">Services</a>
                                            </li>
                                            <li class="">
                                                <a href="track.html">Track Shipment</a>
                                            </li>
                                            <li class="">
                                                <a href="contact.html">Contact Us</a>
                                            </li>
                                        </ul><!-- /.menu -->
                                    </nav><!-- /.mainnav -->
                                </div><!-- /.nav-wrap -->
                            </div><!-- /.flat-wrapper -->
                        </div><!-- /.row -->
                    </div><!-- /.container -->
                </div><!-- /.header-inner -->
            </header><!-- /.header -->
        </div><!-- /.site-header -->
        <div class="page-title parallax parallax4">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="page-title-heading">
                            <h2>Track Shipment</h2>
                        </div><!-- /.page-title-heading -->
                    </div><!-- /.col-md-12 -->
                </div><!-- /.row -->
            </div><!-- /.container -->
        </div><!-- /.page-title -->
        <div id="content" class="container">
            <div class="row">
                <div class="col-md-12" style="padding-top: 8px;">

                    <div id="result" class="hidden">


                        <h4>
                            <center>Track Summary For: <b><span style="color:crimson;">E5704139436-FWG</span></b>
                            </center>
                        </h4>
                        <hr />
                        <div>
                            <div style="background: #eee; padding: 5px 4px;">
                                <div class="row text-center">
                                    <br>
                                    <div class="col-md-4">
                                        Tracking Number
                                        <h4><b>E5704139436-FWG</b></h4>
                                    </div>
                                    <div class="col-md-4">
                                        Origin/Departure
                                        <h4><b>Jamaica</b></h4>
                                    </div>
                                    <div class="col-md-4">
                                        Destination
                                        <h4><b>United States</b></h4>
                                    </div>
                                </div>
                                <hr style="border: 1px solid #fff;" />
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        Sender
                                        <h4>
                                            <b>Jerry Poles </b><br>
                                            <small>00000000</small><br>
                                            <small><a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                                    data-cfemail="3558545c5975504d54584559501b565a58">[email&#160;protected]</a></small>
                                        </h4>
                                    </div>
                                    <div class="col-md-4">
                                        <br>
                                        <span style="color:chocolate; font-weight:600;">Expected Delivery</span>
                                        <h5>
                                            <b>09/11/2023</b>
                                        </h5>
                                        <br>
                                    </div>
                                    <div class="col-md-4">
                                        Receiver
                                        <h4>
                                            <b>Sandra Jonah</b><br>
                                            <small>00009909</small><br>
                                            <small><a href="/cdn-cgi/l/email-protection" class="__cf_email__"
                                                    data-cfemail="5122303f35233011223825347f323e3c">[email&#160;protected]</a></small>
                                        </h4>
                                    </div>
                                </div>
                                <hr style="border: 1px solid #fff;" />
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        Item <br>
                                        <h5><b>Beauty Box</b></h5>
                                    </div>
                                    <div class="col-md-4">
                                        Status
                                        <style>
                                            .blink {
                                                animation: blinkingText 1.2s infinite;
                                            }

                                            @keyframes blinkingText {
                                                0% {
                                                    color: #db0011;
                                                }

                                                49% {
                                                    color: #db0011;
                                                }

                                                60% {
                                                    color: transparent;
                                                }

                                                99% {
                                                    color: transparent;
                                                }

                                                100% {
                                                    color: #fa0202;
                                                }
                                            }
                                        </style>
                                        <h4><b>
                                                <span style="color: green; text-transform:uppercase;">SHIPMENT
                                                    REGISTERED</span></b>
                                        </h4>
                                    </div>
                                    <div class="col-md-4">
                                        Date/Time
                                        <h5><b>
                                                06/11/2023 </b>
                                        </h5>
                                    </div>
                                </div>
                            </div>
                            <hr />

                            <div class="text-center1">
                                <center>
                                    <h4><b>Shipment Progress</b></h4>
                                    <img src="images/barcode.png" style="width: 220px;" /><br>
                                    <h4><b>E5704139436-FWG</b></h4>
                                </center>
                            </div>
                            <hr>
                            <br>
                            <div class="row">
                                <div class="col-md-9 col-md-offset-2">
                                    <style type="text/css">
                                        /* history
                                          -------------------------------------------------------------- */
                                        .history {
                                            margin: 0;
                                            padding: 0;
                                            list-style: none;
                                            margin-bottom: 50px;
                                        }

                                        .history li {
                                            position: relative;
                                            display: inline-block;
                                            width: 100%;
                                            margin-bottom: 50px;
                                            padding-left: 50px;
                                        }

                                        .history li:last-child {
                                            margin-bottom: 0;
                                        }

                                        .history li:last-child:before {
                                            display: none;
                                        }

                                        .history li:after {
                                            content: "";
                                            width: 15px;
                                            height: 15px;
                                            position: absolute;
                                            border: 2px solid #6EBE4F;
                                            left: 0;
                                            top: 3px;
                                            -webkit-border-radius: 100%;
                                            -moz-border-radius: 100%;
                                            -ms-border-radius: 100%;
                                            -o-border-radius: 100%;
                                            border-radius: 100%;
                                        }

                                        .history li:before {
                                            width: 1px;
                                            content: "";
                                            position: absolute;
                                            left: 7px;
                                            top: 23px;
                                            bottom: -48px;
                                            background: rgba(0, 0, 0, 0.1);
                                        }

                                        .history li .title {
                                            margin: 0 0 15px 0;
                                            font-size: 20px;
                                        }

                                        .history li .year {
                                            margin-right: 15px;
                                            color: #fff;
                                            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
                                            padding: 2px 15px 0 15px;
                                            background-color: #6EBE4F;
                                            position: relative;
                                        }

                                        .history li .year:after {
                                            content: "";
                                            position: absolute;
                                            width: 14px;
                                            height: 14px;
                                            left: -7px;
                                            top: 50%;
                                            background-color: #6EBE4F;
                                            margin-top: -7px;
                                            -webkit-transform: rotate(-45deg);
                                            -ms-transform: rotate(-45deg);
                                            transform: rotate(-45deg);
                                        }

                                        .history li:last-child .year:after,
                                        .history li:last-child .year {
                                            background-color: #6EBE4F;
                                        }

                                        .history li:last-child:after {
                                            background-color: #fff;
                                        }

                                        .history li:first-child:after {
                                            background-color: #6EBE4F;
                                            width: 0px;
                                            height: 0px;
                                            border: none;
                                            left: -31px;
                                            top: -5px;
                                            content: url('images/tracking_transit.png');
                                        }

                                        /* History style1 */
                                        .history.style1 {
                                            padding-bottom: 50px;
                                            margin-bottom: 50px;
                                            border-bottom: 1px solid #EBEBEB;
                                        }
                                    </style>

<style>
.tracking-timeline {
    position: relative;
    padding-left: 50px;
    margin-top: 30px;
}
.timeline-item {
    position: relative;
    padding-bottom: 30px;
}
.timeline-item:before {
    content: '';
    position: absolute;
    left: -39px;
    top: 0;
    bottom: -30px;
    width: 2px;
    background: #ddd;
}
.timeline-item:last-child:before {
    display: none;
}
.timeline-dot {
    position: absolute;
    left: -50px;
    top: 0;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: #28a745;
    border: 3px solid white;
    box-shadow: 0 0 0 2px #28a745;
}
.timeline-item.pending .timeline-dot {
    background: #ffc107;
    box-shadow: 0 0 0 2px #ffc107;
}
.timeline-location {
    font-weight: bold;
    font-size: 16px;
    color: #333;
}
.timeline-date {
    color: #666;
    font-size: 13px;
}
.timeline-status {
    color: #28a745;
    margin-top: 5px;
}
.download-label-btn {
    background: #007bff;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin: 20px 0;
}
.download-label-btn:hover {
    background: #0056b3;
}
</style>

<script>
// Update the tracking display JavaScript
async function displayTrackingResults(tcode) {
    try {
        const res = await fetch('/api/track?tcode=' + encodeURIComponent(tcode));
        if (!res.ok) {
            document.getElementById('result').innerHTML = '<p style="color:red;">Tracking code not found</p>';
            return;
        }
        
        const data = await res.json();
        
        // Build timeline HTML
        let timelineHTML = '<div class="tracking-timeline">';
        
        if (data.history && data.history.length > 0) {
            data.history.reverse().forEach((item, index) => {
                const isPending = item.status.toLowerCase() === 'pending';
                timelineHTML += `
                    <div class="timeline-item ${isPending ? 'pending' : ''}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-location">${item.note || item.status}</div>
                        <div class="timeline-date">${item.when}</div>
                        <div class="timeline-status">${item.status.toUpperCase()}</div>
                    </div>
                `;
            });
        }
        
        timelineHTML += '</div>';
        
        // Complete HTML with download button
        const html = `
            <h3>Tracking: <span style="color: #cc0000;">${data.tcode}</span></h3>
            <p><strong>Status:</strong> <span style="color: #28a745; font-weight: bold;">${(data.status || '').toUpperCase()}</span></p>
            <p><strong>Origin:</strong> ${data.origin || 'N/A'} â†’ <strong>Destination:</strong> ${data.destination || 'N/A'}</p>
            
            <button class="download-label-btn" onclick="downloadLabel('${data.tcode}')">
                ðŸ“„ Download Shipping Label (PDF)
            </button>
            
            <h4>Shipment Progress</h4>
            ${timelineHTML}
            
            <h4>Package Details</h4>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                ${(data.products || []).map(p => `
                    <div style="margin-bottom: 10px;">
                        ${p.image ? `<img src="${p.image}" style="max-width: 100px; height: auto; margin-right: 10px;">` : ''}
                        <strong>${p.name || 'Item'}</strong> - Qty: ${p.qty || 'N/A'} - Weight: ${p.weight || 'N/A'}
                    </div>
                `).join('')}
            </div>
        `;
        
        document.getElementById('result').innerHTML = html;
        document.getElementById('result').classList.remove('hidden');
        
    } catch (err) {
        document.getElementById('result').innerHTML = '<p style="color:red;">Error loading tracking data</p>';
    }
}

// Replaced the original simple open-with-server logic with a client-side PDF generator.
// If anything fails, it will fall back to the server endpoint /api/generate-label/<tcode>
async function downloadLabel(tcode) {
    if (!tcode) {
        alert('No tracking code provided');
        return;
    }

    try {
        // Fetch the latest tracking data
        const resp = await fetch('/api/track?tcode=' + encodeURIComponent(tcode));
        if (!resp.ok) {
            // Fallback to server PDF if API not available
            window.open('/api/generate-label/' + encodeURIComponent(tcode), '_blank');
            return;
        }
        const data = await resp.json();

        // Build printable element
        const printable = document.createElement('div');
        printable.style.width = '1000px';
        printable.style.maxWidth = '100%';
        printable.style.background = '#fff';
        printable.style.padding = '16px';
        printable.style.boxSizing = 'border-box';
        printable.style.fontFamily = 'Arial, Helvetica, sans-serif';
        printable.style.color = '#111';
        printable.id = 'firstreed-printable';

        // Header
        const header = document.createElement('div');
        header.style.display = 'flex';
        header.style.justifyContent = 'space-between';
        header.style.alignItems = 'flex-start';
        header.style.borderBottom = '6px solid #f5f5f5';
        header.style.paddingBottom = '8px';
        header.style.marginBottom = '12px';

        const left = document.createElement('div');
        left.style.display = 'flex';
        left.style.alignItems = 'center';
        left.style.gap = '10px';

        const logo = document.createElement('img');
        logo.src = 'images/logo.png';
        logo.style.height = '60px';
        logo.style.width = 'auto';
        logo.style.objectFit = 'contain';
        logo.alt = 'Company logo';

        const comp = document.createElement('div');
        const compName = document.createElement('div');
        compName.textContent = 'FASTREED';
        compName.style.fontSize = '26px';
        compName.style.fontWeight = '700';
        compName.style.color = '#0b57a4';
        const compSub = document.createElement('div');
        compSub.textContent = 'Express Delivery Services';
        compSub.style.fontSize = '12px';
        compSub.style.color = '#666';

        comp.appendChild(compName);
        comp.appendChild(compSub);
        left.appendChild(logo);
        left.appendChild(comp);

        header.appendChild(left);

        const right = document.createElement('div');
        right.style.textAlign = 'left';
        right.style.minWidth = '220px';
        right.innerHTML = `<div style="font-size:11px;color:#666">DOCUMENT: SHIPPING LABEL</div>
                           <div style="font-weight:700;margin-top:8px">${data.tcode || tcode}</div>
                           <div style="font-size:11px;color:#666;margin-top:6px">${data.created_at || ''}</div>`;
        header.appendChild(right);

        printable.appendChild(header);

        // Main content
        const main = document.createElement('div');
        main.style.display = 'flex';
        main.style.gap = '12px';

        const leftCol = document.createElement('div');
        leftCol.style.flex = '1';

        // Sender / Receiver details table
        const table = document.createElement('table');
        table.style.width = '100%';
        table.style.borderCollapse = 'collapse';
        const tbody = document.createElement('tbody');

        function addRow(label, val) {
            const tr = document.createElement('tr');
            const td1 = document.createElement('td');
            td1.style.width = '150px';
            td1.style.fontWeight = '700';
            td1.style.verticalAlign = 'top';
            td1.textContent = label;
            const td2 = document.createElement('td');
            td2.textContent = val || '';
            tr.appendChild(td1);
            tr.appendChild(td2);
            tbody.appendChild(tr);
        }

        addRow("Sender's Name", (data.sender && data.sender.name) || '');
        addRow("Sender's Phone", (data.sender && data.sender.phone) || '');
        addRow("Sender's Email", (data.sender && data.sender.email) || '');
        addRow("Sender's Address", (data.sender && data.sender.address) || data.origin || '');
        addRow("Receiver's Name", (data.receiver && data.receiver.name) || '');
        addRow("Receiver's Phone", (data.receiver && data.receiver.phone) || '');
        addRow("Receiver's Address", (data.receiver && data.receiver.address) || data.destination || '');

        table.appendChild(tbody);
        leftCol.appendChild(table);

        const rightCol = document.createElement('div');
        rightCol.style.width = '320px';

        // Tracking block
        const trackingBlock = document.createElement('div');
        trackingBlock.style.background = '#fff6ea';
        trackingBlock.style.border = '2px solid #ff8c00';
        trackingBlock.style.padding = '12px';
        trackingBlock.style.textAlign = 'center';
        trackingBlock.style.width = '100%';
        trackingBlock.style.boxSizing = 'border-box';
        trackingBlock.style.marginBottom = '10px';

        const tlabel = document.createElement('div');
        tlabel.style.fontSize = '11px';
        tlabel.style.color = '#666';
        tlabel.textContent = 'TRACKING CODE';
        trackingBlock.appendChild(tlabel);

        const tnum = document.createElement('div');
        tnum.style.fontSize = '26px';
        tnum.style.color = '#d84315';
        tnum.style.fontWeight = '700';
        tnum.style.marginTop = '6px';
        tnum.textContent = data.tcode || tcode;
        trackingBlock.appendChild(tnum);

        const contact = document.createElement('div');
        contact.style.fontSize = '12px';
        contact.style.marginTop = '6px';
        contact.textContent = (data.sender && data.sender.phone) ? data.sender.phone : (data.contact || '');
        trackingBlock.appendChild(contact);

        const addr = document.createElement('div');
        addr.style.fontSize = '11px';
        addr.style.color = '#666';
        addr.textContent = data.origin ? (data.origin + ' â†’ ' + (data.destination || '')) : (data.destination || '');
        trackingBlock.appendChild(addr);

        rightCol.appendChild(trackingBlock);

        // Item / Amount / Weight
        const infoBox = document.createElement('div');
        infoBox.style.border = '1px solid #e8e8e8';
        infoBox.style.padding = '8px';
        infoBox.style.fontSize = '12px';
        infoBox.innerHTML = `<div><strong>Item:</strong> ${(data.products && data.products[0] && data.products[0].name) || ''}</div>
                             <div><strong>Amount:</strong> ${data.amount || ''}</div>
                             <div><strong>Weight:</strong> ${(data.products && data.products[0] && data.products[0].weight) || data.weight || ''}</div>`;
        rightCol.appendChild(infoBox);

        // Stamp
        const stampWrap = document.createElement('div');
        stampWrap.style.display = 'flex';
        stampWrap.style.justifyContent = 'flex-end';
        stampWrap.style.marginTop = '12px';
        const stamp = document.createElement('div');
        stamp.style.display = 'flex';
        stamp.style.alignItems = 'center';
        stamp.style.justifyContent = 'center';
        stamp.style.width = '120px';
        stamp.style.height = '120px';
        stamp.style.borderRadius = '50%';
        stamp.style.border = '3px solid #2b7bbd';
        stamp.style.color = '#2b7bbd';
        stamp.style.fontWeight = '700';
        stamp.style.textAlign = 'center';
        stamp.style.fontSize = '12px';
        stamp.innerHTML = 'OFFICE STAMP<br>APPROVED';
        stampWrap.appendChild(stamp);
        rightCol.appendChild(stampWrap);

        main.appendChild(leftCol);
        main.appendChild(rightCol);

        printable.appendChild(main);

        // Barcode image
        const barWrap = document.createElement('div');
        barWrap.style.textAlign = 'center';
        barWrap.style.marginTop = '18px';
        const barcodeImg = document.createElement('img');
        barcodeImg.src = data.barcode || 'images/barcode.png';
        barcodeImg.style.maxWidth = '260px';
        barcodeImg.alt = 'barcode';
        barWrap.appendChild(barcodeImg);
        printable.appendChild(barWrap);

        // Append offscreen for rendering
        printable.style.position = 'fixed';
        printable.style.left = '-9999px';
        printable.style.top = '0';
        document.body.appendChild(printable);

        // Wait for images to load
        const images = printable.querySelectorAll('img');
        await Promise.all(Array.from(images).map(img => {
            if (img.complete) return Promise.resolve();
            return new Promise((res) => { img.onload = img.onerror = res; });
        }));

        // Use html2canvas to capture. If html2canvas/jsPDF not yet loaded, load will be handled below and function retried
        if (typeof html2canvas === 'undefined' || typeof window.jspdf === 'undefined') {
            // remove node and open fallback
            document.body.removeChild(printable);
            // Fallback to server endpoint if libraries are unavailable
            window.open('/api/generate-label/' + encodeURIComponent(tcode), '_blank');
            return;
        }

        const scale = 2;
        const canvas = await html2canvas(printable, {
            scale: scale,
            useCORS: true,
            backgroundColor: '#ffffff',
            windowWidth: printable.scrollWidth,
            windowHeight: printable.scrollHeight
        });

        // Clean up node
        document.body.removeChild(printable);

        const imgData = canvas.toDataURL('image/png');
        const pdfWidth = canvas.width;
        const pdfHeight = canvas.height;

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'px',
            format: [pdfWidth, pdfHeight]
        });
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);

        const filename = (data.tcode || tcode).replace(/\s+/g, '_') + '.pdf';
        pdf.save(filename);

    } catch (err) {
        console.error('PDF generation error', err);
        // final fallback
        window.open('/api/generate-label/' + encodeURIComponent(tcode), '_blank');
    }
}

// Auto-load if tcode in URL
const urlParams = new URLSearchParams(window.location.search);
const tcode = urlParams.get('tcode') || urlParams.get('track');
if (tcode) {
    displayTrackingResults(tcode);
}
</script>


                                    <ul class="history">
                                        <li>
                                            <h4 class="title">Jamaica</h4>
                                            <strong>06/11/2023</strong> at
                                            10:37:52 <br>
                                            <p>Shipment accepted</p>
                                        </li>
                                    </ul><!-- /.history -->
                                </div>
                            </div>
                            <br>

                        </div>
                    </div>
                    <hr />
                    <form action="track.html" method="get" class="">
                        <center>
                            <div class="form-group col-md-12 col-sm-12">
                                <h4><b style="color:red;">TRACK AGAIN</b></h4>
                                <input type="text" id="trackInput" name="tcode" class="form-control input-lg"
                                    placeholder="Enter Tracking Number (e.g. E5704139436-FWG)"><br>
                                <div style=" margin-top:6px;">
                                    <button type="submit" class="btn btn-primary btn-lg">Track</button>
                                </div>
                            </div>
                        </center>
                    </form>
                </div>

            </div>
        </div>

                    <script>
                            // If a tracking code is provided in the query string, call the API and render results
                            (async function() {
                                    function q(name) { return new URLSearchParams(window.location.search).get(name); }
                                    const t = q('tcode') || q('track');
                                    if (!t) return;

                                    const resultDiv = document.getElementById('result');
                                    try {
                                            const res = await fetch('/api/track?tcode=' + encodeURIComponent(t));
                                            if (!res.ok) {
                                                    const err = await res.json().catch(() => ({}));
                                                    resultDiv.innerHTML = '<p style="color:red; text-align:center;">Tracking error: ' + (err.error || res.status) + '</p>';
                                                    resultDiv.classList.remove('hidden');
                                                    return;
                                            }
                                            const data = await res.json();
                                            // Build a simple result view using returned record fields
                                            const products = (data.products || []).map(p => {
                                                let html = '<li style="margin-bottom:15px;border:1px solid #ddd;padding:10px;border-radius:5px;">';
                                                if (p.image) html += '<img src="' + p.image + '" style="max-width:150px;height:auto;display:block;margin-bottom:10px;border-radius:3px;" />';
                                                html += '<strong>Product:</strong> ' + (p.name||'') + '<br>';
                                                html += '<strong>Qty:</strong> ' + (p.qty||'') + '<br>';
                                                html += '<strong>Weight:</strong> ' + (p.weight||'') + '</li>';
                                                return html;
                                            }).join('');
                                            const history = (data.history || []).map(h => '<li><strong>' + (h.when||'') + '</strong> â€” ' + (h.status||'') + (h.note?(': ' + h.note):'') + '</li>').join('');

                                            resultDiv.innerHTML = `
                                                    <h4><center>Track Summary For: <b><span style="color:crimson;">${data.tcode || t}</span></b></center></h4>
                                                    <hr />
                                                    <div style="background:#eee;padding:12px;">
                                                        <div style="display:flex;gap:20px;justify-content:space-around;text-align:center;">
                                                            <div><div>Tracking Number</div><h4><b>${data.tcode || ''}</b></h4></div>
                                                            <div><div>Origin/Departure</div><h4><b>${data.origin || ''}</b></h4></div>
                                                            <div><div>Destination</div><h4><b>${data.destination || ''}</b></h4></div>
                                                        </div>
                                                        <hr />
                                                        <div style="display:flex;gap:20px;justify-content:space-around;text-align:center;">
                                                            <div>
                                                                <div>Sender</div>
                                                                <h4><b>${(data.sender && data.sender.name) || ''}</b><br><small>${(data.sender && data.sender.phone)||''}</small><br><small>${(data.sender && data.sender.email)||''}</small></h4>
                                                            </div>
                                                            <div>
                                                                <div>Expected Delivery</div>
                                                                <h4><b>${data.expectedDelivery || ''}</b></h4>
                                                            </div>
                                                            <div>
                                                                <div>Receiver</div>
                                                                <h4><b>${(data.receiver && data.receiver.name) || ''}</b><br><small>${(data.receiver && data.receiver.phone)||''}</small><br><small>${(data.receiver && data.receiver.email)||''}</small></h4>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                        <div style="display:flex;gap:20px;justify-content:space-around;text-align:center;">
                                                            <div>Item<br><h5><b>${(data.products && data.products[0] && data.products[0].name) || 'N/A'}</b></h5></div>
                                                            <div>Status<br><h4><b><span style="color:green;text-transform:uppercase;">${data.status || ''}</span></b></h4></div>
                                                            <div>Date/Time<br><h5><b>${data.created_at || ''}</b></h5></div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div style="padding:10px;">
                                                        <h4>Products</h4>
                                                        <ul>${products || '<li>No products</li>'}</ul>
                                                        <h4>History</h4>
                                                        <ul>${history || '<li>No history</li>'}</ul>
                                                    </div>
                                            `;

                                            resultDiv.classList.remove('hidden');
                                    } catch (err) {
                                            resultDiv.innerHTML = '<p style="color:red; text-align:center;">Connection error: ' + (err.message || err) + '</p>';
                                            resultDiv.classList.remove('hidden');
                                    }
                            })();
                    </script>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-widgets">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="widge widget_text">
                                <div class="textwidget">
                                    <h2>Firstreed Express Delivery Services - Providing Smart Logistics Solution Across
                                        The World.</h2>
                                </div>
                            </div><!-- /.widget_text -->
                        </div><!-- /.col-md-4 -->

                        <div class="col-md-4">
                            <div class="widget widget_nav_menu">
                                <h3 class="widget-title">Information</h3>
                                <div class="menu-footer-menu-container">
                                    <ul class="menu-footer-menu">
                                        <li><a href="./">Home</a></li>
                                        <li><a href="services.html">Sea/Ocean Freight</a></li>
                                        <li><a href="about.html">About Us</a></li>
                                        <li><a href="services.html">Road Transportation</a></li>
                                        <li><a href="services.html">Our Services</a></li>
                                        <li><a href="services.html">Air Freight</a></li>
                                        <li><a href="contact.html">Contact Us</a></li>
                                        <li><a href="services.html">Warehousing</a></li>
                                        <li> <a href="track.html">Track & Trace</a></li>
                                        <li><a href="NCBFAA_terms.pdf">NCBFAA Terms</a></li>
                                        <li><a href="diplomatic">Diplomatic Bag and Secure Logistics</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div><!-- /.col-md-4 -->

                        <div class="col-md-4">
                            <div class="widget widget_text information">
                                <h3 class="widget-title">Contact Us</h3>
                                <div class="textwidget">
                                    <p><strong>Firstreed Express Delivery Services</strong><br></p>
                                    <p>
                                        <i class="fa fa-envelope"></i><a href="/cdn-cgi/l/email-protection"
                                            class="__cf_email__"
                                            data-cfemail="7110151c181f311710020503141415140901031402025f121e1c">[email&#160;protected]</a><br>
                                        <i class="fa fa-clock-o"></i> <strong>Monday - Saturday:</strong> 08:00 a.m â€“
                                        08:00
                                        p.m<br>
                                        <i class="fa fa-clock-o"></i> <strong>Sunday:</strong> 08:00 a.m â€“ 06:00 p.m

                                    </p>
                                </div>
                            </div>
                        </div><!-- /.col-md-4 -->
                    </div><!-- /.row -->
                </div><!-- /.container -->
            </div><!-- /.footer-content -->

            <div class="footer-content">
                <div class="container">
                    <div class="row">
                        <div class="flat-wrapper">
                            <div class="ft-wrap clearfix">
                                <div class="social-links">
                                    <a href="#"><i class="fa fa-twitter"></i></a>
                                    <a href="#"><i class="fa fa-facebook-official"></i></a>
                                    <a href="#"><i class="fa fa-google-plus"></i></a>
                                    <a href="#"><i class="fa fa-pinterest"></i></a>
                                </div>
                                <div class="copyright">
                                    <div class="copyright-content">
                                        Copyright &copy; 2025 Firstreed Express Delivery Services. | All Rights
                                        Reserved.
                                    </div>
                                </div>
                            </div><!-- /.ft-wrap -->
                        </div><!-- /.flat-wrapper -->
                    </div><!-- /.row -->
                </div><!-- /.container -->
            </div><!-- /.footer-content -->
        </footer>
        <!-- Go Top -->
        <a class="go-top">
            <i class="fa fa-chevron-up"></i>
        </a>
        <div class="icon-before">
            <div class="icon-bar">
                <center>
                    <div class="google_translate_element" id="google_translate_element"></div>
                    <div id="goog-gt-tt" class="goog-tooltip skiptranslate"></div>
                </center>
            </div>
        </div>
        <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
        <script type="text/javascript">
            function googleTranslateElementInit() {
                new google.translate.TranslateElement({
                    autoDisplay: false
                }, 'google_translate_element');
            }
        </script>
        <script type="text/javascript"
            src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
            </script>
    </div>

    <!-- Javascript -->
    <script type="text/javascript" src="javascript/jquery.min.js"></script>
    <script type="text/javascript" src="javascript/bootstrap.min.js"></script>
    <script type="text/javascript" src="javascript/jquery.easing.js"></script>
    <script type="text/javascript" src="javascript/owl.carousel.js"></script>
    <script type="text/javascript" src="javascript/jquery-waypoints.js"></script>
    <script type="text/javascript" src="javascript/jquery-countTo.js"></script>
    <script type="text/javascript" src="javascript/jquery.flexslider-min.js"></script>
    <script type="text/javascript" src="javascript/jquery.cookie.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="javascript/gmap3.min.js"></script>
    <script type="text/javascript" src="javascript/jquery-validate.js"></script>
    <script type="text/javascript" src="javascript/parallax.js"></script>
    <script type="text/javascript" src="javascript/main.js"></script>

    <script type="text/javascript" src="javascript/jquery.magnific-popup.min.js"></script>

    <!-- Track script: fetches /api/track?tcode and renders results -->
    <script type="text/javascript" src="javascript/track.js"></script>

    <!-- Revolution Slider -->
    <script type="text/javascript" src="javascript/jquery.themepunch.tools.min.js"></script>
    <script type="text/javascript" src="javascript/jquery.themepunch.revolution.min.js"></script>
    <script type="text/javascript" src="javascript/slider.js"></script>

    <!-- jVector maps -->
    <script src="vendors/jquery-jvectormap/jquery-jvectormap-2.0.3.min.js"></script>
    <script src="vendors/jquery-jvectormap/jvectormap-worldmill.js"></script>
    <script src="vendors/jquery-jvectormap/locations.js"></script>

    <!-- Added libraries for client-side PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        integrity="sha512-BNa5mExHn8aC3f1pJ6Y9uQvGvH6D1Y1wIt7b0G6f5r3uWnqXc2gNQmA0p6b0P8qg0h7gq8zK6l2r8Y1E2g6e3g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
        integrity="sha512-+mKjH5kltq2xg8wq4fK6mR7kLp1d4c3o6d9P3d1w2k3lE0k3Z9g4Gh6j9c7s1w4tZ1Y1n7x2z3w4k5u6v7w=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Track.js already exists; keep it. The new downloadLabel override above will be used by the HTML generated later -->
    <script type="text/javascript" src="javascript/jquery.themepunch.tools.min.js"></script>
    <script type="text/javascript" src="javascript/jquery.themepunch.revolution.min.js"></script>
    <script type="text/javascript" src="javascript/slider.js"></script>

    <style>
        body {
            top: 0px !important;
        }

        .icon-before {
            padding-top: 0px;
        }

        .icon-bar {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #1a2130;
            color: white;
            text-align: center;
        }

        .VIpgJd-ZVi9od-ORHb-OEVmcd {
            display: none;
        }

        #google_translate_element {
            width: 100px;
            color: #fff;
            text-align: right;
            display: block
        }

        .goog-te-banner-frame.skiptranslate {
            display: none !important;
        }



        #goog-gt-tt {
            display: none !important;
            top: 0px !important;
        }

        .goog-tooltip skiptranslate {
            display: none !important;
            top: 0px !important;
        }

        .activity-root {
            display: hide !important;
        }

        .status-message {
            display: hide !important;
        }

        .started-activity-container {
            display: hide !important;
        }

        .goog-te-banner-frame.skiptranslate {
            display: none !important;
        }
    </style>
    <style>
        /* WhatsApp Chat Icon Styles */
        .whatsapp-chat {
            position: fixed;
            bottom: 20px;
            left: 20px;
            /* Positioning on the left */
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .message-us {
            background-color: white;
            color: #25D366;
            padding: 10px 15px;
            border-radius: 20px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .message-us img.whatsapp-icon-small {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .whatsapp-icon {
            width: 50px;
            height: 50px;
        }

        .whatsapp-chat:hover .message-us {
            display: flex;
            /* Show the message on hover */
        }
    </style>
    <script>
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }
    </script>

    <!-- Add this block for the WhatsApp chat icon -->
    <a href="https://wa.me/447832398350" target="_blank" class="whatsapp-chat">
        <div class="message-us">
            <img src="img/whatsapp-icon.webp" alt="WhatsApp Icon" class="whatsapp-icon-small"> Message Us
        </div>
        <img src="img/whatsapp-icon.webp" alt="WhatsApp Icon" class="whatsapp-icon">
    </a>
    <script defer
        src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015"
        integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ=="
        data-cf-beacon='{"version":"2024.11.0","token":"85540cb831c24c5a9d26d5032912ecab","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}'
        crossorigin="anonymous"></script>
</body>

</html>
